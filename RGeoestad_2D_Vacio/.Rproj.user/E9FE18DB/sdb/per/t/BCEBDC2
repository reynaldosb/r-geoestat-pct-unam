{
    "collab_server" : "",
    "contents" : "#--------------------------------------------------------------#\n#                 Univariate Spatial Estimation                #\n#--------------------------------------------------------------#\n\ndir.create(paste(getwd(),\"/Results/EstimacionEspacial\", sep=\"\"))\nlibrary(gstat)\nlibrary(geoR)\n\n######## Radar_mm_Log\n#modelos de variograma (1- exponential, 2- spherical, 3- gaussian)\nRadar_mm_Log_vario_model<- 1\nRadar_mm_Log_nugget<- 0.17\nRadar_mm_Log_sill_and_nugget<- 1.25\nRadar_mm_Log_rank <- 20000\n\nminPoints<-4\nmaxPoints<-10\n\nlibrary(gstat)\nlibrary(geoR)\nlibrary(sp)\n\n# \"CoorX\" X axis coordinates\n# \"CoorY\" Y axis coordinates\n# \"Prop1\" property\n# \"Modelo\" can take values 1 (Exponential), 2 (Spherical) or 3 (Gaussian).\n# \"SillYNugget\" Sill\n# \"Alcance\" variogram model range\n# \"minPar\" is the minimum number of points to do the estimation\n# \"maxPar\" is the maximu number of points to do the estimation\n# \"Xmin\" the minimum X value\n# \"Xmax\" the maximum X value\n# \"Ymin\" the minimum Y value\n# \"Ymax\" the maximum Y value\n# \"TX\" # width of the cells in the X direction for kriging estimation\n# \"TY\" # width of the cells in the Y direction for kriging estimation\n# \"InvT\" is the transformation made:0 for no transformation, 1 for \"log\", 2 for \"square root\", and 3 for \"inverse\" transformatio\n# \"NameX\" is the name of the X axis\n# \"NameY\" is the name of the Y axis\npng(\"Results/EstimacionEspacial/Radar_mm_Log_Kriging.png\", bg = \"white\")\nRadar_mm_Log_OrdKrig <- KrigingOrd(CoorX = XCoord, CoorY = YCoord, \n                             Prop1 = Radar_mm_Log, Modelo = Radar_mm_Log_vario_model, Nugget = Radar_mm_Log_nugget, \n                             SillYNugget = Radar_mm_Log_sill_and_nugget, Alcance = Radar_mm_Log_rank,\n                             minPar = minPoints, maxPar = maxPoints, \n                             Xmin = XCoord_Stat[2,2], Xmax = XCoord_Stat[7,2], \n                             Ymin = YCoord_Stat[2,2], Ymax = YCoord_Stat[7,2], \n                             TX=DistMin, TY=DistMin, InvT=1, NameX=\"X (Km)\", \n                             NameY=\"Y (Km)\", Titulo1=\"Kriging Radar_mm_Log (ppm)\", \n                             Titulo2=\"SD Radar_mm_Log (ppm)\") \ndev.off()\nhead(Radar_mm_Log_OrdKrig)\n# en esta parte se rializan los gráficos anteriores de manera separada \nsource(file.choose()) # choose PlotGridCells.R\npng(\"Results/EstimacionEspacial/Radar_mm_Log_Kriging_Est.png\", bg = \"white\")\nPlotGridCells(Z=Radar_mm_Log_OrdKrig[,3],\n              x=Radar_mm_Log_OrdKrig[,1:2],\n              PointsCoord = cbind(XCoord, YCoord),\n              grid = list(x = unique(Radar_mm_Log_OrdKrig[,1]),\n                          y = unique(Radar_mm_Log_OrdKrig[,2])),\n              xlab = \"X (Km)\", ylab = \"Y (Km)\",\n              main = \"Kriging Est Radar_mm_Log (ppm)\")\n#points(Data_File(,1:2), cex=3, pech=)\ndev.off()\n\npng(\"Results/EstimacionEspacial/Radar_mm_Log_Kriging_SD.png\", bg = \"white\")\nPlotGridCells(Z=Radar_mm_Log_OrdKrig[,4],\n              x=Radar_mm_Log_OrdKrig[,1:2],\n              PointsCoord = cbind(XCoord, YCoord),\n              grid = list(x = unique(Radar_mm_Log_OrdKrig[,1]),\n                          y = unique(Radar_mm_Log_OrdKrig[,2])),\n              xlab = \"X (Km)\", ylab = \"Y (Km)\",\n              main = \"Kriging SD Radar_mm_Log (ppm)\")\ndev.off()\n# en el caso de tener un valor de anisotopria de 2 a 3, correr esta parte\n# \"malla\" is the length of the squared grid cells. Instead of \"TX\" and \"TY\"\n# \"MaxAnis\" refers to the main axis direction: it is the angle for the principal direction of continuity (measured in degrees, clockwise from positive Y, i.e. North)\n# \"proporcion\" is the anisotropy ratio, the ratio of the minor range to the major range (a value between 0 and 1)\npng(\"Results/EstimacionEspacial/Radar_mm_Log_KrigingAnis.png\", bg = \"white\")\nPluv_mm_Log_OrdKrig <- KrigingOrdAnis(CoorX = XCoord, CoorY = YCoord, \n               Prop1 = Radar_mm_Log, Modelo = Radar_mm_Log_vario_model, Nugget = Radar_mm_Log_nugget, \n               SillYNugget = Radar_mm_Log_sill_and_nugget, Alcance = Radar_mm_Log_rank,\n               minPar = minPoints, maxPar = maxPoints,\n               malla = DistMin, InvT = 1, MaxAnis = 0, proporcion = 0.5,\n               NameX=\"X (Km)\", \n               NameY=\"Y (Km)\", Titulo1=\"Anisotropic Kriging Radar_mm_Log (ppm)\", \n               Titulo2=\"SD Radar_mm_Log (ppm)\")\ndev.off()\n\n######## Pluv_mm_Log, aquí mejor modelo del análisis univariada\nPluv_mm_Log_vario_model<- 2\nPluv_mm_Log_nugget<- 0.3\nPluv_mm_Log_sill_and_nugget<- 1.12\nPluv_mm_Log_rank <- 20000\npng(\"Results/EstimacionEspacial/Pluv_mm_Log_Kriging.png\", bg = \"white\")\nPluv_mm_Log_OrdKrig <- KrigingOrd(CoorX = XCoord, CoorY = YCoord, \n                                   Prop1 = Pluv_mm_Log, Modelo = Pluv_mm_Log_vario_model, Nugget = Pluv_mm_Log_nugget, \n                                   SillYNugget = Pluv_mm_Log_sill_and_nugget, Alcance = Pluv_mm_Log_rank,\n                                   minPar = minPoints, maxPar = maxPoints, \n                                   Xmin = XCoord_Stat[2,2], Xmax = XCoord_Stat[7,2], \n                                   Ymin = YCoord_Stat[2,2], Ymax = YCoord_Stat[7,2], \n                                   TX=DistMin, TY=DistMin, InvT=1, NameX=\"X (Km)\", \n                                   NameY=\"Y (Km)\", Titulo1=\"Kriging Pluv_mm_Log (ppm)\", \n                                   Titulo2=\"SD Pluv_mm_Log (ppm)\") \ndev.off()\nhead(Pluv_mm_Log_OrdKrig)\n\n#--------------------------------------------------------------#\n#       Bivariate Variography (Structural)  Modeling           #\n#--------------------------------------------------------------#\n\n# Estimation of the experimental variogram\nX_rng<-XCoord_Stat[8,2]\nY_rng<-YCoord_Stat[8,2]\nN_lags<-14\nDistMin<-min(dist(Data_File[,1:2])) # Minimum distance in data\nDistMax<-max(dist(Data_File[,1:2])) # Maximum distance in data\nlag_value<-3000 #max((DistMax/2)/N_lags, DistMin)\npng(\"Results/EstimacionEspacial/Radar_mm_Log_Pluv_mm_Log_CrossVario.png\", bg = \"white\")\nRadar_mm_Log_Pluv_mm_Log_CrossVario<-CrossVariograma(CoorX = XCoord, CoorY = YCoord, \n                                             P1 = Radar_mm_Log, P2 = Pluv_mm_Log, \n                                             NInt = N_lags, lags = lag_value,\n                                             Direccion = 0, Tol = 90, \n                                             NomP1 = 'Radar_mm_Log Variogram',\n                                             NomP2 = 'Pluv_mm_Log Variogram',\n                                             NomP1P2 = 'Radar_mm_Log-Pluv_mm_Log CrossVariogram')\ndev.off()\n\n# Radar_mm_Log\nRadar_mm_Log_vario_model<- 2 #modelo del variograma 1 exponencial, 2 esférico, 3 gaussiano\nRadar_mm_Log_nugget<- 0.2\nRadar_mm_Log_sill_and_nugget<- 0.86\nRadar_mm_Log_rank <- 20000\n# Pluv_mm_Log\nPluv_mm_Log_vario_model<- 2\nPluv_mm_Log_nugget<- 0.2\nPluv_mm_Log_sill_and_nugget<- 1.1\nPluv_mm_Log_rank <- 20000\n# Cross-variogram\nRadar_mm_Log_Pluv_mm_Log_vario_model<- 2 # spherical\nRadar_mm_Log_Pluv_mm_Log_nugget<- 0.1\nRadar_mm_Log_Pluv_mm_Log_sill_and_nugget<- .8\nRadar_mm_Log_Pluv_mm_Log_rank <- 20000\n\npng(\"Results/EstimacionEspacial/Radar_mm_Log_Pluv_mm_Log_CrossVarioModel.png\", bg = \"white\")\nModelVariogram(XCoord, YCoord, \n               Radar_mm_Log, Pluv_mm_Log, \n               N_lags, lag_value, 0, 90, \n               Radar_mm_Log_Pluv_mm_Log_vario_model, \n               Radar_mm_Log_sill_and_nugget, Pluv_mm_Log_sill_and_nugget, Radar_mm_Log_Pluv_mm_Log_sill_and_nugget, \n               Radar_mm_Log_nugget, Pluv_mm_Log_nugget, Radar_mm_Log_Pluv_mm_Log_nugget, Radar_mm_Log_Pluv_mm_Log_rank, \n               'Radar_mm_Log Variogram', 'Pluv_mm_Log Variogram', 'Radar_mm_Log-Pluv_mm_Log CrossVariogram')\ndev.off()\n\n# Verificar que se cumple que el modelo es positivo definido!!!!, revisar diapositiva num 13\nNugetMatrix <- matrix(c(Pluv_mm_Log_nugget,\n                        Radar_mm_Log_Pluv_mm_Log_nugget,\n                        Radar_mm_Log_Pluv_mm_Log_nugget,\n                        Radar_mm_Log_nugget), ncol = 2)\ndet(NugetMatrix) #entre más alejado de cero, es mejor\nSemiVariMatrix1 <- c(Pluv_mm_Log_sill_and_nugget,\n                     Radar_mm_Log_Pluv_mm_Log_sill_and_nugget,\n                     Radar_mm_Log_Pluv_mm_Log_sill_and_nugget,\n                     Radar_mm_Log_sill_and_nugget)\nSillMatrix <- matrix(SemiVariMatrix1, ncol = 2)\nSill_NuggetMatrix <- SillMatrix - NugetMatrix\nwhich(Sill_NuggetMatrix < 0) # which(Model2 < 0, arr.ind = T)\ndet(Sill_NuggetMatrix) #determinante siempre mayor que zero\n\n# pdfResults <- matrix(c(.2, .17, .17, .2), ncol = 2, byrow = TRUE)\n# det(pdfResults)\n\npng(\"Results/EstimacionEspacial/Radar_mm_Log_Pluv_mm_Log_CrossValidation.png\", bg = \"white\")\nPluv_mm_Log_CrossValid2<- CrossValidation2(XCoord, YCoord, \n                                        Pluv_mm_Log, Radar_mm_Log, \n                                        N_lags, lag_value, Radar_mm_Log_Pluv_mm_Log_vario_model, \n                                        Pluv_mm_Log_sill_and_nugget, Radar_mm_Log_sill_and_nugget, Radar_mm_Log_Pluv_mm_Log_sill_and_nugget, \n                                        Pluv_mm_Log_nugget, Radar_mm_Log_nugget, Radar_mm_Log_Pluv_mm_Log_nugget, Radar_mm_Log_Pluv_mm_Log_rank)\ndev.off()\nhead(Pluv_mm_Log_CrossValid2)\n\n# Basic Statistics in a single table\nPluv_mm_Log_CrossValid2_Sta <- Val_Estadisticos(Pluv_mm_Log_CrossValid2[,c(3,4,5)])\n\n# Histogram and Boxplot 1\npng(\"Results/EstimacionEspacial/Pluv_mm_Log-Pluv_mm_Log+_HistBoxPlot1CoKrig.png\", bg = \"white\")\nHistBoxplot(x=Pluv_mm_Log_CrossValid2[,5], mean = Pluv_mm_Log_CrossValid2_Sta[5,3], median = Pluv_mm_Log_CrossValid2_Sta[4,3], main =\"\", \n            xlab = \"Pluv_mm_Log-Pluv_mm_Log* (ppm)\", ylab = \"Frecuencia Absoluta (conteo)\", AbsFreq = TRUE, PercentFreq = FALSE )\ndev.off()\n\n# CoKrigingCrossValFit <- FitDistribution(data = Pluv_mm_Log_CrossValid2[,5], DISTR=\"norm\", BREAKS = \"Sturges\", col = \"darkgray\", DistName = \"Normal\")\n\n# Spatial Distribution of differences (Z-Z*)\npng(\"Results/AnalisisEstructural/Pluv_mm_Log_CoKrigingCrossValid_Spatial_Distr.png\", bg = \"white\")\nDEspacial(Pluv_mm_Log_CrossValid2[,1], Pluv_mm_Log_CrossValid2[,2], Pluv_mm_Log_CrossValid2[,5],\n          'X (Km)', 'Y (Km)', 'Pluv_mm_Log-Pluv_mm_Log* (ppm)', 'Pluv_mm_Log - Pluv_mm_Log*')\ndev.off()\n\n#--------------------------------------------------------------#\n#                 Bivariate Spatial Estimation                 #\n#--------------------------------------------------------------#\npng(\"Results/EstimacionEspacial/Radar_mm_Log_CoKrig.png\", bg = \"white\")\nRadar_mm_Log_CoKrig <- CoKrigingOrd(XCoord, YCoord, \n                              Pluv_mm_Log, Radar_mm_Log,\n                              Radar_mm_Log_Pluv_mm_Log_vario_model, \n                              Pluv_mm_Log_sill_and_nugget, Radar_mm_Log_sill_and_nugget, Radar_mm_Log_Pluv_mm_Log_sill_and_nugget, \n                              Pluv_mm_Log_nugget, Radar_mm_Log_nugget,\n                              Radar_mm_Log_Pluv_mm_Log_nugget, Radar_mm_Log_Pluv_mm_Log_rank, \n                              minPar = minPoints, maxPar = maxPoints,\n                              Xmin = XCoord_Stat[2,2], Xmax = XCoord_Stat[7,2], \n                              Ymin = YCoord_Stat[2,2], Ymax = YCoord_Stat[7,2],\n                              TX=DistMin, TY=DistMin, InvT=1, NameX=\"X (Km)\", \n                              NameY=\"Y (Km)\", Titulo1=\"CoKriging Pluv_mm_Log (ppm)\", \n                              Titulo2=\"SD Pluv_mm_Log (ppm)\")\ndev.off()",
    "created" : 1478882584053.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1801392695",
    "id" : "BCEBDC2",
    "lastKnownWriteTime" : 1478910737,
    "last_content_update" : 1478910737358,
    "path" : "~/Documents/2017-1/geoest/RGeoestad_2D_Vacio/scripts/EstimacionEspacial.R",
    "project_path" : "scripts/EstimacionEspacial.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}